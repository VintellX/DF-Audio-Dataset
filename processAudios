#!/bin/bash

# Convert all .wav files/audios to an uncompressed PCM format
# -> PCM encoding 16-bit little-endian with sample rate of 16 kHz and in 1 channel

ROOT_DIR="."

newFolder="ProcessedAudios"
mkdir -p "$newFolder"
echo "Processing Audios xD"

> eror.txt # Error (typo) in file name xD

find "$ROOT_DIR" -mindepth 1 -maxdepth 1 -type d | while read -r folder; do
    prevDir=$(basename "$folder") 
    
    mkdir -p "$newFolder/$prevDir"

    find "$folder" -type f -name "*.wav" | while read -r audio_phile; do
        relative_path="${audio_phile#$ROOT_DIR/}"
        
        dir_path=$(dirname "$relative_path")
        
        output_dir="$newFolder/$dir_path"
        mkdir -p "$output_dir"

        output_file="$output_dir/$(basename "$audio_phile")"

		outputo=$(ffmpeg -i "$audio_phile" -acodec pcm_s16le -ar 16000 -ac 1 "$output_file" 2>&1)

        if [ $? -ne 0 ]; then
            echo "Error processing: $audio_phile" >> eror.txt
            echo "FFmpeg command: $cmdXD" >> eror.txt
            echo "Error message:" >> eror.txt
            echo "$outputo" >> eror.txt
            echo "----------------------------------------" >> eror.txt
        else
            echo "Processed: $audio_phile -> $output_file"
        fi
    done
done

echo "Done bruv :D"
